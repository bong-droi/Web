{% load static %}
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <title>Danh sách món</title>
  <link rel="stylesheet" href="{% static 'menu/css/menu.css' %}">
</head>
<body class="m-wrap">
  <header class="m-head">
    <h1>Danh sách món</h1>
    <a class="btn" href="{% url 'menu_create' %}">+ Thêm món</a>
  </header>

  {% if messages %}
    <div class="msg">
      {% for m in messages %}
        <div class="alert {{ m.tags }}">{{ m }}</div>
      {% endfor %}
    </div>
  {% endif %}

  <form class="filters" method="get">
    <input class="in" type="search" name="q" value="{{ q }}" placeholder="Tìm tên/mô tả...">
    <select class="in" name="cat">
      <option value="">Tất cả danh mục</option>
      {% for c in categories %}
        <option value="{{ c.id }}" {% if c.id|stringformat:"s" == cat %}selected{% endif %}>{{ c.name }}</option>
      {% endfor %}
    </select>
    <label class="chkline">
      <input type="checkbox" name="on" value="1" {% if only_on %}checked{% endif %}>
      Chỉ hiển thị món đang bán
    </label>
    <button class="btn" type="submit">Lọc</button>
  </form>

  <div class="grid">
    {% for it in page_obj %}
      <div class="card">
        <div class="pic">
          {% if it.image %}
            <img src="{{ it.image.url }}" alt="{{ it.name }}">
          {% else %}
            <div class="noimg">☕</div>
          {% endif %}
          {% if not it.is_available %}<span class="badge off">Tạm ngưng</span>{% endif %}
        </div>
        <div class="meta">
          <h3>{{ it.name }}</h3>
          <p class="muted">{{ it.category.name|default:"Không phân loại" }}</p>
          <div class="price">{{ it.price|floatformat:0 }}₫ <span class="unit">/{{ it.unit }}</span></div>
          {% if it.description %}<p class="desc">{{ it.description }}</p>{% endif %}
        </div>
        <div class="actions">
          <a class="btn ghost" href="{% url 'menu_edit' it.id %}">Sửa</a>
          <form method="post" action="{% url 'menu_delete' it.id %}" onsubmit="return confirm('Xóa món này?')">
            {% csrf_token %}
            <button class="btn danger" type="submit">Xóa</button>
          </form>
        </div>
      </div>
    {% empty %}
      <p class="muted">Chưa có món nào.</p>
    {% endfor %}
  </div>

  {% if page_obj.paginator.num_pages > 1 %}
    <nav class="pager">
      {% if page_obj.has_previous %}
        <a class="pg" href="?q={{ q }}&cat={{ cat }}&on={% if only_on %}1{% endif %}&page={{ page_obj.previous_page_number }}">‹ Trước</a>
      {% endif %}
      <span class="pg current">Trang {{ page_obj.number }}/{{ page_obj.paginator.num_pages }}</span>
      {% if page_obj.has_next %}
        <a class="pg" href="?q={{ q }}&cat={{ cat }}&on={% if only_on %}1{% endif %}&page={{ page_obj.next_page_number }}">Sau ›</a>
      {% endif %}
    </nav>
  {% endif %}
</body>
</html>
